<!DOCTYPE html>
<html lang="en">
  <head>
    <title>three.js webgl - STL</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <link
      type="text/css"
      rel="stylesheet"
      href="https://threejs.org/examples/main.css"
    />
  </head>
  <body>
    <script type="module">
      import * as THREE from 'https://threejs.org/build/three.module.js'

      import { STLLoader } from 'https://threejs.org/examples/jsm/loaders/STLLoader.js'

      const models = [
        {
          id: 1,
          name: 'Stanford bunny',
          stlUrl:
            'https://threejs.org/examples/models/stl/ascii/slotted_disk.stl',
          color: '#ff0000',
        },
        {
          id: 2,
          name: 'Eiffel-tower',
          stlUrl: 'https://ozeki.hu/attachments/116/Eiffel_tower_sample.STL',
          color: '#0000ff',
        },
        {
          id: 3,
          name: 'Menger sponge',
          stlUrl: 'https://ozeki.hu/attachments/116/Menger_sponge_sample.stl',
          color: '#ffffff',
        },
      ]
      const model = models[0]

      let container

      let camera, scene, renderer

      init()
      render()

      function init() {
        container = document.createElement('div')
        document.body.appendChild(container)

        camera = new THREE.PerspectiveCamera(
          35,
          window.innerWidth / window.innerHeight,
          1,
          15
        )
        camera.position.set(3, 0.15, 3)

        const cameraTarget = new THREE.Vector3(0, 0, 0)
        camera.lookAt(cameraTarget)

        scene = new THREE.Scene()
        scene.background = new THREE.Color(0xffffff)

        const loader = new STLLoader()

        loader.load(
          'https://threejs.org/examples/models/stl/ascii/slotted_disk.stl',
          (geometry) => {
            const material = new THREE.MeshPhongMaterial({
              color: 0xff5533,
              specular: 0x111111,
              shininess: 200,
            })
            const mesh = new THREE.Mesh(geometry, material)

            mesh.position.set(0, 0, 0)
            mesh.rotation.set(0, 0, 0)
            mesh.scale.set(1, 1, 1)

            mesh.castShadow = true
            mesh.receiveShadow = true

            scene.add(mesh)
            // scene.add(new THREE.BoxHelper(mesh, 0x000000))

            render()
          }
        )

        // Lights
        scene.add(new THREE.HemisphereLight(0x443333, 0x111122))
        addShadowedLight(1, 1, 1, 0xffffff, 1.35)
        addShadowedLight(0.5, 1, -1, 0xffffff, 0.5)

        // renderer
        renderer = new THREE.WebGLRenderer({ antialias: true })
        renderer.setPixelRatio(window.devicePixelRatio)
        renderer.setSize(window.innerWidth, window.innerHeight)
        renderer.outputEncoding = THREE.sRGBEncoding
        renderer.shadowMap.enabled = true

        container.appendChild(renderer.domElement)
      }

      function addShadowedLight(x, y, z, color, intensity) {
        const directionalLight = new THREE.DirectionalLight(color, intensity)
        directionalLight.position.set(x, y, z)
        scene.add(directionalLight)

        directionalLight.castShadow = true

        const d = 1
        directionalLight.shadow.camera.left = -d
        directionalLight.shadow.camera.right = d
        directionalLight.shadow.camera.top = d
        directionalLight.shadow.camera.bottom = -d

        directionalLight.shadow.camera.near = 1
        directionalLight.shadow.camera.far = 4

        directionalLight.shadow.bias = -0.002
      }

      function render() {
        renderer.render(scene, camera)
      }
    </script>
  </body>
</html>
